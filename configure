#!/bin/bash
# A shell scipt for configure for macOS only.

CFGFN=.config

# Automatic detecting architecture.
KRNL=`uname -s`
KVER=`uname -r | cut -d . -f1`
ARCH=`uname -m`

if [ "${KRNL}" != "Darwin " ];then
	echo "This configure works for only macOS."
fi

# Check .config exists ?
if [ -e ${CFGFN} ];then
	rm -f ${CFGGN}
fi

# Searching for libssl.
echo -n "Checking libssl ... "
SR=`ls -ldC1 /usr/local/Cellar/openssl*`
SRLIST=(${SR})
if [ -e ${SRLIST[0]} ];then
	echo "${SRLIST[0]}"
	SR=`ls -ldC1 ${SRLIST[0]}/*`
	SRLIST=(${SR})
	if [ -e ${SRLIST[0]} ];then
		echo -n "Checking libssl.a ... "
		TESTPATH="${SRLIST[0]}/lib/libssl.a"
		if [ -e ${TESTPATH} ];then
			echo "libssl found."
			echo " ... at ${TESTPATH}"
			echo "LIBSSL=\"${TESTPATH}\"" >> .config
		else
			echo "failure."
			echo "libssl not found at ${TESTPATH}"
			exit 0
		fi
		echo -n "Checking libcrypto.a ... "
		TESTPATH="${SRLIST[0]}/lib/libcrypto.a"
		if [ -e ${TESTPATH} ];then
			echo "libcrypto found."
			echo " ... at ${TESTPATH}"
			echo "LIBCRYPTO=\"${TESTPATH}\"" >> .config
		else
			echo "failure."
			echo "libcrypto not found at ${TESTPATH}"
			exit 0
		fi
	else
		echo "failure"
		echo "libssl directory existed, but seems no contains library."
		exit 0
	fi
else
	echo "failure."
	echo "libssl not existed, install with 'brew install libssl'."
	exit 0
fi

echo -n "Checking libssh2 ... "
SR=`ls -ldC1 /usr/local/lib/libssh*.a`
SRLIST=(${SR})
if [ -e ${SRLIST[0]} ];then
	echo "libssh2 found."
	echo " ... at ${SRLIST[0]}"
	echo "LIBSSH2=\"${SRLIST[0]}\"" >> .config
else
	echo "failure."
	echo "libssh2 not existed, install with 'brew install openssh'."
	exit 0
fi

echo "Done."
